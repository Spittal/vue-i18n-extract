!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("path"),require("is-valid-glob"),require("glob"),require("fs"),require("dot-object"),require("js-yaml"),require("esm")):"function"==typeof define&&define.amd?define(["exports","path","is-valid-glob","glob","fs","dot-object","js-yaml","esm"],t):t((e=e||self).vueI18NExtract={},e.path,e.isValidGlob,e.glob,e.fs,e.dot,e.yaml,e.esm)}(this,function(e,t,r,a,n,s,o,i){function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function u(e){if(!r(e))throw new Error("vueFiles isn't a valid glob pattern.");var t=a.sync(e);if(0===t.length)throw new Error("vueFiles glob has no files.");return t.map(e=>({fileName:e.replace(process.cwd(),""),path:e,content:n.readFileSync(e,"utf8")}))}function*c(e,t,r){for(void 0===r&&(r=1);;){var a=t.exec(e.content);if(null===a)break;var n=(e.content.substring(0,a.index).match(/\n/g)||[]).length+1;yield{path:a[r],line:n,file:e.fileName}}}function p(e){return u(e).reduce((e,t)=>[...e,...function(e){return[...c(e,/(?:[$ .]tc?)\(\s*?(["'`])((?:[^\\]|\\.)*?)\1/g,2)]}(t),...function(e){return[...c(e,/(?:<i18n|<I18N)(?:.|\n)*?(?:[^:]path=("|'))(.*?)\1/g,2)]}(t),...function(e){return[...c(e,/v-t="'(.*?)'"/g)]}(t)],[])}function f(e){if(!r(e))throw new Error("languageFiles isn't a valid glob pattern.");var s=a.sync(e);if(0===s.length)throw new Error("languageFiles glob has no files.");return s.map(e=>{var r=t.resolve(process.cwd(),e),a=r.substring(r.lastIndexOf(".")).toLowerCase(),s=".yaml"===a||".yml"===a?o.safeLoad(n.readFileSync(r,"utf8")):require(r),i=s.default?s.default:s;return{fileName:e.replace(process.cwd(),""),path:e,content:JSON.stringify(i)}})}function d(e,r){f(e).forEach(e=>{var a=JSON.parse(e.content);r.forEach(t=>{(t.language&&e.fileName.includes(t.language)||!t.language)&&s.str(t.path,"",a)});var i=e.fileName.substring(e.fileName.lastIndexOf(".")+1),l=t.resolve(process.cwd()+e.fileName),u=JSON.stringify(a,null,2);if("json"===i)n.writeFileSync(l,u);else if("js"===i)n.writeFileSync(l,"export default "+u+"; \n");else if("yaml"===i||"yml"===i){var c=o.safeDump(a);n.writeFileSync(l,c)}})}function y(e){return f(e).reduce((e,t)=>{var r=t.fileName.substring(t.fileName.lastIndexOf("/")+1,t.fileName.lastIndexOf(".")),a=s.dot(JSON.parse(t.content)),n=Object.keys(a).map((e,r)=>({line:r,path:e,file:t.fileName}));return e[r]=n,e},{})}var g;function m(t,r,a){void 0===a&&(a=e.VueI18NExtractReportTypes.Missing+e.VueI18NExtractReportTypes.Unused);var n=[],s=[],o=[],i=a&e.VueI18NExtractReportTypes.Dynamic;Object.keys(r).forEach(e=>{var a=r[e];t.forEach(t=>{var s=function(e){return e.path===t.path||e.path.startsWith(t.path+".")};i&&(t.path.includes("${")||t.path.endsWith("."))?o.push(l({},t,{language:e})):(r[e].some(s)||n.push(l({},t,{language:e})),a=a.filter(e=>i?!function(e,t){return t.some(t=>e.path.includes(t.path))}(e,o)&&!s(e):!s(e)))}),s.push(...a.map(t=>l({},t,{language:e})))});var u={};return a&e.VueI18NExtractReportTypes.Missing&&(u=Object.assign(u,{missingKeys:n})),a&e.VueI18NExtractReportTypes.Unused&&(u=Object.assign(u,{unusedKeys:s})),i&&(u=Object.assign(u,{dynamicKeys:o})),u}async function h(e,t){var r=JSON.stringify(e);return new Promise((e,a)=>{n.writeFile(t,r,t=>{t?a(t):e()})})}function v(r,a,n){var s=t.resolve(process.cwd(),r),o=t.resolve(process.cwd(),a);return m(p(s),y(o),n.dynamic?e.VueI18NExtractReportTypes.All:e.VueI18NExtractReportTypes.Missing+e.VueI18NExtractReportTypes.Unused)}async function b(e){var{vueFiles:r,languageFiles:a,output:n,add:s,dynamic:o}=e,i=v(r,a,e);i.missingKeys&&(console.info("missing keys: "),console.table(i.missingKeys)),i.unusedKeys&&(console.info("unused keys: "),console.table(i.unusedKeys)),i.dynamicKeys&&o&&o>1&&(console.info("dynamic detected keys: "),console.table(i.dynamicKeys)),n&&(await h(i,t.resolve(process.cwd(),n)),console.log("The report has been has been saved to "+n)),s&&i.missingKeys&&i.missingKeys.length>0&&(d(t.resolve(process.cwd(),a),i.missingKeys),console.log("The missing keys have been added to your languages files"))}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,require=i(module),(g=e.VueI18NExtractReportTypes||(e.VueI18NExtractReportTypes={}))[g.None=0]="None",g[g.Missing=1]="Missing",g[g.Unused=2]="Unused",g[g.Dynamic=4]="Dynamic",g[g.All=7]="All";var N=l({},{__proto__:null,createI18NReport:v,reportCommand:b,readVueFiles:u,parseVueFiles:p,writeMissingToLanguage:d,parseLanguageFiles:y,get VueI18NExtractReportTypes(){return e.VueI18NExtractReportTypes},extractI18NReport:m,writeReportToFile:h});e.createI18NReport=v,e.default=N,e.extractI18NReport=m,e.parseLanguageFiles=y,e.parseVueFiles=p,e.readVueFiles=u,e.reportCommand=b,e.writeMissingToLanguage=d,e.writeReportToFile=h});
//# sourceMappingURL=vue-i18n-extract.umd.js.map
