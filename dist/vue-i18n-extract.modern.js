import e from"path";import n from"is-valid-glob";import s from"glob";import r from"fs";import t from"dot-object";import i from"js-yaml";import a from"esm";function o(){return(o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function l(e){if(!n(e))throw new Error("vueFiles isn't a valid glob pattern.");var t=s.sync(e);if(0===t.length)throw new Error("vueFiles glob has no files.");return t.map(e=>({fileName:e.replace(process.cwd(),""),path:e,content:r.readFileSync(e,"utf8")}))}function*u(e,n,s){for(void 0===s&&(s=1);;){var r=n.exec(e.content);if(null===r)break;var t=(e.content.substring(0,r.index).match(/\n/g)||[]).length+1;yield{path:r[s],line:t,file:e.fileName}}}function c(e){return l(e).reduce((e,n)=>[...e,...function(e){return[...u(e,/(?:[$ .]tc?)\(\s*?(["'`])((?:[^\\]|\\.)*?)\1/g,2)]}(n),...function(e){return[...u(e,/(?:<i18n|<I18N)(?:.|\n)*?(?:[^:]path=("|'))(.*?)\1/g,2)]}(n),...function(e){return[...u(e,/v-t="'(.*?)'"/g)]}(n)],[])}function f(t){if(!n(t))throw new Error("languageFiles isn't a valid glob pattern.");var a=s.sync(t);if(0===a.length)throw new Error("languageFiles glob has no files.");return a.map(n=>{var s=e.resolve(process.cwd(),n),t=s.substring(s.lastIndexOf(".")).toLowerCase(),a=".yaml"===t||".yml"===t?i.safeLoad(r.readFileSync(s,"utf8")):require(s),o=a.default?a.default:a;return{fileName:n.replace(process.cwd(),""),path:n,content:JSON.stringify(o)}})}function g(n,s){f(n).forEach(n=>{var a=JSON.parse(n.content);s.forEach(e=>{(e.language&&n.fileName.includes(e.language)||!e.language)&&t.str(e.path,"",a)});var o=n.fileName.substring(n.fileName.lastIndexOf(".")+1),l=e.resolve(process.cwd()+n.fileName),u=JSON.stringify(a,null,2);if("json"===o)r.writeFileSync(l,u);else if("js"===o)r.writeFileSync(l,"export default "+u+"; \n");else if("yaml"===o||"yml"===o){var c=i.safeDump(a);r.writeFileSync(l,c)}})}function p(e){return f(e).reduce((e,n)=>{var s=n.fileName.substring(n.fileName.lastIndexOf("/")+1,n.fileName.lastIndexOf(".")),r=t.dot(JSON.parse(n.content)),i=Object.keys(r).map((e,s)=>({line:s,path:e,file:n.fileName}));return e[s]=i,e},{})}var d;function m(e,n,s){void 0===s&&(s=d.Missing+d.Unused);var r=[],t=[],i=[],a=s&d.Dynamic;Object.keys(n).forEach(s=>{var l=n[s];e.forEach(e=>{var t=function(n){return n.path===e.path||n.path.startsWith(e.path+".")};a&&(e.path.includes("${")||e.path.endsWith("."))?i.push(o({},e,{language:s})):(n[s].some(t)||r.push(o({},e,{language:s})),l=l.filter(e=>a?!function(e,n){return n.some(n=>e.path.includes(n.path))}(e,i)&&!t(e):!t(e)))}),t.push(...l.map(e=>o({},e,{language:s})))});var l={};return s&d.Missing&&(l=Object.assign(l,{missingKeys:r})),s&d.Unused&&(l=Object.assign(l,{unusedKeys:t})),a&&(l=Object.assign(l,{dynamicKeys:i})),l}async function y(e,n){var s=JSON.stringify(e);return new Promise((e,t)=>{r.writeFile(n,s,n=>{n?t(n):e()})})}function h(n,s,r){var t=e.resolve(process.cwd(),n),i=e.resolve(process.cwd(),s);return m(c(t),p(i),r.dynamic?d.All:d.Missing+d.Unused)}async function v(n){var{vueFiles:s,languageFiles:r,output:t,add:i,dynamic:a}=n,o=h(s,r,n);o.missingKeys&&(console.info("missing keys: "),console.table(o.missingKeys)),o.unusedKeys&&(console.info("unused keys: "),console.table(o.unusedKeys)),o.dynamicKeys&&a&&a>1&&(console.info("dynamic detected keys: "),console.table(o.dynamicKeys)),t&&(await y(o,e.resolve(process.cwd(),t)),console.log("The report has been has been saved to "+t)),i&&o.missingKeys&&o.missingKeys.length>0&&(g(e.resolve(process.cwd(),r),o.missingKeys),console.log("The missing keys have been added to your languages files"))}require=a(module),function(e){e[e.None=0]="None",e[e.Missing=1]="Missing",e[e.Unused=2]="Unused",e[e.Dynamic=4]="Dynamic",e[e.All=7]="All"}(d||(d={}));var w=o({},{__proto__:null,createI18NReport:h,reportCommand:v,readVueFiles:l,parseVueFiles:c,writeMissingToLanguage:g,parseLanguageFiles:p,get VueI18NExtractReportTypes(){return d},extractI18NReport:m,writeReportToFile:y});export default w;export{d as VueI18NExtractReportTypes,h as createI18NReport,m as extractI18NReport,p as parseLanguageFiles,c as parseVueFiles,l as readVueFiles,v as reportCommand,g as writeMissingToLanguage,y as writeReportToFile};
//# sourceMappingURL=vue-i18n-extract.modern.js.map
