import{Command as e}from"commander";import t from"path";import n from"is-valid-glob";import r from"glob";import a from"fs";import o from"dot-object";import s from"js-yaml";import i from"esm";function*l(e,t,n){for(void 0===n&&(n=1);;){var r=t.exec(e.content);if(null===r)break;var a=(e.content.substring(0,r.index).match(/\n/g)||[]).length+1;yield{path:r[n],line:a,file:e.fileName}}}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var c;require=i(module),function(e){e[e.None=0]="None",e[e.Missing=1]="Missing",e[e.Unused=2]="Unused",e[e.All=3]="All"}(c||(c={}));var f=new e;f.command("report",{isDefault:!0}).description("Create a report from a glob of your Vue.js source files and your language files.").requiredOption("-v, --vueFiles <vueFiles>","The Vue.js file(s) you want to extract i18n strings from. It can be a path to a folder or to a file. It accepts glob patterns. (ex. *, ?, (pattern|pattern|pattern)").requiredOption("-l, --languageFiles <languageFiles>","The language file(s) you want to compare your Vue.js file(s) to. It can be a path to a folder or to a file. It accepts glob patterns (ex. *, ?, (pattern|pattern|pattern) ").option("-o, --output <output>","Use if you want to create a json file out of your report. (ex. -o output.json)").option("-a, --add","Use if you want to add missing keys into your json language files.").action(async function(e){var{vueFiles:i,languageFiles:f,output:p,add:g}=e,m=t.resolve(process.cwd(),i),d=t.resolve(process.cwd(),f),h=function(e,t,n){void 0===n&&(n=c.All);var r=[],a=[];Object.keys(t).forEach(n=>{var o=t[n];e.forEach(e=>{var a=function(t){return t.path===e.path||t.path.startsWith(e.path+".")};t[n].some(a)||r.push(u({},e,{language:n})),o=o.filter(e=>!a(e))}),a.push(...o.map(e=>u({},e,{language:n})))});var o={};return n&c.Missing&&(o=Object.assign(o,{missingKeys:r})),n&c.Unused&&(o=Object.assign(o,{unusedKeys:a})),o}(function(e){if(!n(e))throw new Error("vueFiles isn'\t a valid glob pattern.");var t=r.sync(e);if(0===t.length)throw new Error("vueFiles glob has no files.");return t.map(e=>({fileName:e.replace(process.cwd(),""),path:e,content:a.readFileSync(e,"utf8")}))}(m).reduce((e,t)=>[...e,...function(e){return[...l(e,/(?:[$ .]tc?)\(\s*?(["'`])((?:[^\\]|\\.)*?)\1/g,2)]}(t),...function(e){return[...l(e,/(?:<i18n|<I18N)(?:.|\n)*?(?:[^:]path=("|'))(.*?)\1/g,2)]}(t),...function(e){return[...l(e,/v-t="'(.*?)'"/g)]}(t)],[]),function(e){if(!n(e))throw new Error("languageFiles isn'\t a valid glob pattern.");var o=r.sync(e);if(0===o.length)throw new Error("languageFiles glob has no files.");return o.map(e=>{var n=t.resolve(process.cwd(),e),r=n.substring(n.lastIndexOf(".")).toLowerCase(),o=".yaml"===r||".yml"===r?s.safeLoad(a.readFileSync(n,"utf8")):require(n),i=o.default?o.default:o;return{fileName:e.replace(process.cwd(),""),path:e,content:i}})}(d).reduce((e,t)=>{var n=t.fileName.substring(t.fileName.lastIndexOf("/")+1,t.fileName.lastIndexOf(".")),r=o.dot(t.content),a=Object.keys(r).map((e,n)=>({line:n,path:e,file:t.fileName}));return e[n]=a,e},{}));h.missingKeys&&console.table(h.missingKeys),h.unusedKeys&&console.table(h.unusedKeys),p&&(await async function(e,t){var n=JSON.stringify(e);return new Promise((e,r)=>{a.writeFile(t,n,t=>{t?r(t):e()})})}(h,t.resolve(process.cwd(),p)),console.log("The report has been has been saved to "+p)),g&&h.missingKeys&&h.missingKeys.length>0&&(function(e,t){var n=r.sync(e),s=n.map(e=>a.readFileSync(e,"utf8")).map(e=>JSON.parse(e));t.forEach(e=>{s.forEach(t=>o.str(e.path,"",t))}),s.map(e=>JSON.stringify(e,null,2)).forEach((e,t)=>a.writeFileSync(n[t],e))}(d,h.missingKeys),console.log("The missing keys has been has been saved to your languages files"))}),f.parseAsync(process.argv);
//# sourceMappingURL=vue-i18n-extract.modern.js.map
