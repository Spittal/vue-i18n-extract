import e from"path";import r from"is-valid-glob";import n from"glob";import t from"fs";import s from"dot-object";import a from"js-yaml";import i from"esm";function o(){return(o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function l(e){if(!r(e))throw new Error("vueFiles isn't a valid glob pattern.");var s=n.sync(e);if(0===s.length)throw new Error("vueFiles glob has no files.");return s.map(e=>({fileName:e.replace(process.cwd(),""),path:e,content:t.readFileSync(e,"utf8")}))}function*u(e,r,n){for(void 0===n&&(n=1);;){var t=r.exec(e.content);if(null===t)break;var s=(e.content.substring(0,t.index).match(/\n/g)||[]).length+1;yield{path:t[n],line:s,file:e.fileName}}}function c(e){return l(e).reduce((e,r)=>[...e,...function(e){return[...u(e,/(?:[$ .]tc?)\(\s*?(["'`])((?:[^\\]|\\.)*?)\1/g,2)]}(r),...function(e){return[...u(e,/(?:<i18n|<I18N)(?:.|\n)*?(?:[^:]path=("|'))(.*?)\1/g,2)]}(r),...function(e){return[...u(e,/v-t="'(.*?)'"/g)]}(r)],[])}function f(s){if(!r(s))throw new Error("languageFiles isn't a valid glob pattern.");var i=n.sync(s);if(0===i.length)throw new Error("languageFiles glob has no files.");return i.map(r=>{var n=e.resolve(process.cwd(),r),s=n.substring(n.lastIndexOf(".")).toLowerCase(),i=".yaml"===s||".yml"===s?a.safeLoad(t.readFileSync(n,"utf8")):require(n),o=i.default?i.default:i;return{fileName:r.replace(process.cwd(),""),path:r,content:JSON.stringify(o)}})}function g(r,n){f(r).forEach(r=>{var i=JSON.parse(r.content);n.forEach(e=>{(e.language&&r.fileName.includes(e.language)||!e.language)&&s.str(e.path,"",i)});var o=r.fileName.substring(r.fileName.lastIndexOf(".")+1),l=e.resolve(process.cwd()+r.fileName),u=JSON.stringify(i,null,2);if("json"===o)t.writeFileSync(l,u);else if("js"===o)t.writeFileSync(l,"export default "+u+"; \n");else if("yaml"===o||"yml"===o){var c=a.safeDump(i);t.writeFileSync(l,c)}})}function p(e){return f(e).reduce((e,r)=>{var n=r.fileName.substring(r.fileName.lastIndexOf("/")+1,r.fileName.lastIndexOf(".")),t=s.dot(JSON.parse(r.content)),a=Object.keys(t).map((e,n)=>({line:n,path:e,file:r.fileName}));return e[n]=a,e},{})}var m;function d(e,r,n){void 0===n&&(n=m.All);var t=[],s=[];Object.keys(r).forEach(n=>{var a=r[n];e.forEach(e=>{var s=function(r){return r.path===e.path||r.path.startsWith(e.path+".")};r[n].some(s)||t.push(o({},e,{language:n})),a=a.filter(e=>!s(e))}),s.push(...a.map(e=>o({},e,{language:n})))});var a={};return n&m.Missing&&(a=Object.assign(a,{missingKeys:t})),n&m.Unused&&(a=Object.assign(a,{unusedKeys:s})),a}async function v(e,r){var n=JSON.stringify(e);return new Promise((e,s)=>{t.writeFile(r,n,r=>{r?s(r):e()})})}function h(r,n){var t=e.resolve(process.cwd(),r),s=e.resolve(process.cwd(),n);return d(c(t),p(s))}async function y(r){var{vueFiles:n,languageFiles:t,output:s,add:a}=r,i=h(n,t);i.missingKeys&&console.table(i.missingKeys),i.unusedKeys&&console.table(i.unusedKeys),s&&(await v(i,e.resolve(process.cwd(),s)),console.log("The report has been has been saved to "+s)),a&&i.missingKeys&&i.missingKeys.length>0&&(g(e.resolve(process.cwd(),t),i.missingKeys),console.log("The missing keys have been added to your languages files"))}require=i(module),function(e){e[e.None=0]="None",e[e.Missing=1]="Missing",e[e.Unused=2]="Unused",e[e.All=3]="All"}(m||(m={}));var w=o({},{__proto__:null,createI18NReport:h,reportCommand:y,readVueFiles:l,parseVueFiles:c,writeMissingToLanguage:g,parseLanguageFiles:p,get VueI18NExtractReportTypes(){return m},extractI18NReport:d,writeReportToFile:v});export default w;export{m as VueI18NExtractReportTypes,h as createI18NReport,d as extractI18NReport,p as parseLanguageFiles,c as parseVueFiles,l as readVueFiles,y as reportCommand,g as writeMissingToLanguage,v as writeReportToFile};
//# sourceMappingURL=vue-i18n-extract.modern.js.map
