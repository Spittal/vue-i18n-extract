import e from"path";import r from"is-valid-glob";import n from"glob";import s from"fs";import t from"dot-object";import a from"js-yaml";import i from"esm";function*o(e,r,n){for(void 0===n&&(n=1);;){var s=r.exec(e.content);if(null===s)break;var t=(e.content.substring(0,s.index).match(/\n/g)||[]).length+1;yield{path:s[n],line:t,file:e.fileName}}}function l(t){if(!r(t))throw new Error("languageFiles isn't a valid glob pattern.");var i=n.sync(t);if(0===i.length)throw new Error("languageFiles glob has no files.");return i.map(r=>{var n=e.resolve(process.cwd(),r),t=n.substring(n.lastIndexOf(".")).toLowerCase(),i=".yaml"===t||".yml"===t?a.safeLoad(s.readFileSync(n,"utf8")):require(n),o=i.default?i.default:i;return{fileName:r.replace(process.cwd(),""),path:r,content:JSON.stringify(o)}})}function u(){return(u=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var c;function f(a,i){var f=e.resolve(process.cwd(),a),g=e.resolve(process.cwd(),i);return function(e,r,n){void 0===n&&(n=c.All);var s=[],t=[];Object.keys(r).forEach(n=>{var a=r[n];e.forEach(e=>{var t=function(r){return r.path===e.path||r.path.startsWith(e.path+".")};r[n].some(t)||s.push(u({},e,{language:n})),a=a.filter(e=>!t(e))}),t.push(...a.map(e=>u({},e,{language:n})))});var a={};return n&c.Missing&&(a=Object.assign(a,{missingKeys:s})),n&c.Unused&&(a=Object.assign(a,{unusedKeys:t})),a}(function(e){if(!r(e))throw new Error("vueFiles isn't a valid glob pattern.");var t=n.sync(e);if(0===t.length)throw new Error("vueFiles glob has no files.");return t.map(e=>({fileName:e.replace(process.cwd(),""),path:e,content:s.readFileSync(e,"utf8")}))}(f).reduce((e,r)=>[...e,...function(e){return[...o(e,/(?:[$ .]tc?)\(\s*?(["'`])((?:[^\\]|\\.)*?)\1/g,2)]}(r),...function(e){return[...o(e,/(?:<i18n|<I18N)(?:.|\n)*?(?:[^:]path=("|'))(.*?)\1/g,2)]}(r),...function(e){return[...o(e,/v-t="'(.*?)'"/g)]}(r)],[]),l(g).reduce((e,r)=>{var n=r.fileName.substring(r.fileName.lastIndexOf("/")+1,r.fileName.lastIndexOf(".")),s=t.dot(JSON.parse(r.content)),a=Object.keys(s).map((e,n)=>({line:n,path:e,file:r.fileName}));return e[n]=a,e},{}))}require=i(module),function(e){e[e.None=0]="None",e[e.Missing=1]="Missing",e[e.Unused=2]="Unused",e[e.All=3]="All"}(c||(c={}));var g={createI18NReport:f,reportCommand:async function(r){var n,i,{vueFiles:o,languageFiles:u,output:c,add:g}=r,p=f(o,u);p.missingKeys&&console.table(p.missingKeys),p.unusedKeys&&console.table(p.unusedKeys),c&&(await async function(e,r){var n=JSON.stringify(e);return new Promise((e,t)=>{s.writeFile(r,n,r=>{r?t(r):e()})})}(p,e.resolve(process.cwd(),c)),console.log("The report has been has been saved to "+c)),g&&p.missingKeys&&p.missingKeys.length>0&&(n=e.resolve(process.cwd(),u),i=p.missingKeys,l(n).forEach(r=>{var n=JSON.parse(r.content);i.forEach(e=>{(e.language&&r.fileName.includes(e.language)||!e.language)&&t.str(e.path,"",n)});var o=r.fileName.substring(r.fileName.lastIndexOf(".")+1),l=e.resolve(process.cwd()+r.fileName),u=JSON.stringify(n,null,2);if("json"===o)s.writeFileSync(l,u);else if("js"===o)s.writeFileSync(l,"export default "+u+"; \n");else if("yaml"===o||"yml"===o){var c=a.safeDump(n);s.writeFileSync(l,c)}}),console.log("The missing keys have been added to your languages files"))}};export default g;
//# sourceMappingURL=vue-i18n-extract.modern.js.map
