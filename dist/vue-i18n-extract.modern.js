import{Command as e}from"commander";import t from"path";import r from"is-valid-glob";import n from"glob";import a from"fs";import o from"dot-object";import s from"js-yaml";import i from"esm";function*l(e,t,r){for(void 0===r&&(r=1);;){var n=t.exec(e.content);if(null===n)break;var a=(e.content.substring(0,n.index).match(/\n/g)||[]).length+1;yield{path:n[r],line:a,file:e.fileName}}}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var c;require=i(module),function(e){e[e.None=0]="None",e[e.Missing=1]="Missing",e[e.Unused=2]="Unused",e[e.All=3]="All"}(c||(c={}));var f=new e;f.command("report",{isDefault:!0}).description("Create a report from a glob of your Vue.js source files and your language files.").requiredOption("-v, --vueFiles <vueFiles>","The Vue.js file(s) you want to extract i18n strings from. It can be a path to a folder or to a file. It accepts glob patterns. (ex. *, ?, (pattern|pattern|pattern)").requiredOption("-l, --languageFiles <languageFiles>","The language file(s) you want to compare your Vue.js file(s) to. It can be a path to a folder or to a file. It accepts glob patterns (ex. *, ?, (pattern|pattern|pattern) ").option("-o, --output <output>","Use if you want to create a json file out of your report. (ex. -o output.json)").option("-a, --add","Use if you want to add missing keys into your json language files. (ex. -a true)").action(async function(e){var{vueFiles:i,languageFiles:f,output:p,add:g}=e,m=t.resolve(process.cwd(),i),d=t.resolve(process.cwd(),f),h=function(e,t,r){void 0===r&&(r=c.All);var n=[],a=[];Object.keys(t).forEach(r=>{var o=t[r];e.forEach(e=>{var a=function(t){return t.path===e.path||t.path.startsWith(e.path+".")};t[r].some(a)||n.push(u({},e,{language:r})),o=o.filter(e=>!a(e))}),a.push(...o.map(e=>u({},e,{language:r})))});var o={};return r&c.Missing&&(o=Object.assign(o,{missingKeys:n})),r&c.Unused&&(o=Object.assign(o,{unusedKeys:a})),o}(function(e){if(!r(e))throw new Error("vueFiles isn'\t a valid glob pattern.");var t=n.sync(e);if(0===t.length)throw new Error("vueFiles glob has no files.");return t.map(e=>({fileName:e.replace(process.cwd(),""),path:e,content:a.readFileSync(e,"utf8")}))}(m).reduce((e,t)=>[...e,...function(e){return[...l(e,/(?:[$ .]tc?)\(\s*?(["'`])((?:[^\\]|\\.)*?)\1/g,2)]}(t),...function(e){return[...l(e,/(?:<i18n|<I18N)(?:.|\n)*?(?:[^:]path=("|'))(.*?)\1/g,2)]}(t),...function(e){return[...l(e,/v-t="'(.*?)'"/g)]}(t)],[]),function(e){if(!r(e))throw new Error("languageFiles isn'\t a valid glob pattern.");var o=n.sync(e);if(0===o.length)throw new Error("languageFiles glob has no files.");return o.map(e=>{var r=t.resolve(process.cwd(),e),n=r.substring(r.lastIndexOf(".")).toLowerCase(),o=".yaml"===n||".yml"===n?s.safeLoad(a.readFileSync(r,"utf8")):require(r),i=o.default?o.default:o;return{fileName:e.replace(process.cwd(),""),path:e,content:i}})}(d).reduce((e,t)=>{var r=t.fileName.substring(t.fileName.lastIndexOf("/")+1,t.fileName.lastIndexOf(".")),n=o.dot(t.content),a=Object.keys(n).map((e,r)=>({line:r,path:e,file:t.fileName}));return e[r]=a,e},{}));h.missingKeys&&console.table(h.missingKeys),h.unusedKeys&&console.table(h.unusedKeys),p&&(await async function(e,t){var r=JSON.stringify(e);return new Promise((e,n)=>{a.writeFile(t,r,t=>{t?n(t):e()})})}(h,t.resolve(process.cwd(),p)),console.log("The report has been has been saved to "+p)),g&&h.missingKeys&&h.missingKeys.length>0&&(function(e,t){var r=n.sync(e),s=r.map(e=>a.readFileSync(e,"utf8")).map(e=>JSON.parse(e));t.forEach(e=>{s.forEach(t=>o.str(e.path,"",t))}),s.map(e=>JSON.stringify(e,null,2)).forEach((e,t)=>a.writeFileSync(r[t],e))}(d,h.missingKeys),console.log("The missing keys has been has been saved to your languages files"))}),f.parseAsync(process.argv);
//# sourceMappingURL=vue-i18n-extract.modern.js.map
