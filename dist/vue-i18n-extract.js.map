{"version":3,"file":"vue-i18n-extract.js","sources":["../src/config-file/vue-i18n-extract.config.ts","../src/config-file/index.ts","../src/create-report/vue-files.ts","../src/create-report/language-files.ts","../src/create-report/report.ts","../src/create-report/index.ts","../src/index.ts"],"sourcesContent":["export default {\n  // Options documented in vue-i18n-extract readme.\n  vueFiles: './src/**/*.?(js|vue)',\n  languageFiles: './lang/**/*.?(json|yaml|yml|js)',\n  output: false,\n  add: false,\n  remove: false,\n  ci: false,\n};\n","import cac from 'cac';\nimport fs from 'fs';\nimport path from 'path';\nimport defaultConfig from './vue-i18n-extract.config';\n\nexport function initCommand(): void {\n  fs.writeFileSync(\n    path.resolve(process.cwd(), './vue-i18n-extract.config.js'),\n    `module.exports = ${JSON.stringify(defaultConfig, null, 2)}`,\n  );\n}\n\nexport function resolveConfig (): Record<string, string>  {\n  const argvOptions = cac().parse(process.argv, { run: false }).options;\n\n  try {\n    const pathToConfigFile = path.resolve(process.cwd(), './vue-i18n-extract.config.js');\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    const configFile = require(pathToConfigFile);\n\n    console.info(`\\nUsing config file found at ${pathToConfigFile}`);\n\n    return {\n      ...configFile,\n      ...argvOptions\n    };\n  } catch {\n    return argvOptions;\n  }\n}\n","import { SimpleFile, I18NItemWithBounding } from '../types';\nimport isValidGlob from 'is-valid-glob';\nimport glob from 'glob';\nimport fs from 'fs';\n\nexport function readVueFiles (src: string): SimpleFile[] {\n  if (!isValidGlob(src)) {\n    throw new Error(`vueFiles isn't a valid glob pattern.`);\n  }\n\n  const targetFiles = glob.sync(src);\n\n  if (targetFiles.length === 0) {\n    throw new Error('vueFiles glob has no files.');\n  }\n\n  return targetFiles.map((f) => {\n    const fileName = f.replace(process.cwd(), '');\n    return { fileName, path: f, content: fs.readFileSync(f, 'utf8') };\n  });\n}\n\nfunction* getMatches (file: SimpleFile, regExp: RegExp, captureGroup = 1): IterableIterator<I18NItemWithBounding> {\n  while (true) {\n    const match = regExp.exec(file.content);\n    if (match === null) {\n      break;\n    }\n    const path = match[captureGroup];\n\n    const pathAtIndex = file.content.indexOf(path);\n    const previousCharacter = file.content.charAt(pathAtIndex - 1);\n    const nextCharacter = file.content.charAt(pathAtIndex + path.length);\n\n    const line = (file.content.substring(0, match.index).match(/\\n/g) || []).length + 1;\n    yield {\n      path,\n      previousCharacter,\n      nextCharacter,\n      file: file.fileName,\n      line,\n    };\n  }\n}\n\n/**\n * Extracts translation keys from methods such as `$t` and `$tc`.\n *\n * - **regexp pattern**: (?:[$ .]tc?)\\(\n *\n *   **description**: Matches the sequence t( or tc(, optionally with either “$”, “.” or “ ” in front of it.\n *\n * - **regexp pattern**: ([\"'`])\n *\n *   **description**: 1. capturing group. Matches either “\"”, “'”, or “`”.\n *\n * - **regexp pattern**: ((?:[^\\\\]|\\\\.)*?)\n *\n *   **description**: 2. capturing group. Matches anything except a backslash\n *   *or* matches any backslash followed by any character (e.g. “\\\"”, “\\`”, “\\t”, etc.)\n *\n * - **regexp pattern**: \\1\n *\n *   **description**: matches whatever was matched by capturing group 1 (e.g. the starting string character)\n *\n * @param file a file object\n * @returns a list of translation keys found in `file`.\n */\n function extractMethodMatches (file: SimpleFile): I18NItemWithBounding[] {\n  const methodRegExp = /(?:[$ .]tc?)\\(\\s*?([\"'`])((?:[^\\\\]|\\\\.)*?)\\1/g;\n  return [ ...getMatches(file, methodRegExp, 2) ];\n}\n\nfunction extractComponentMatches (file: SimpleFile): I18NItemWithBounding[] {\n  const componentRegExp = /(?:<(?:i18n|Translation))(?:.|\\n)*?(?:[^:]path=(\"|'))((?:[^\\\\]|\\\\.)*?)\\1/gi;\n  return [ ...getMatches(file, componentRegExp, 2) ];\n}\n\nfunction extractDirectiveMatches (file: SimpleFile): I18NItemWithBounding[] {\n  const directiveRegExp = /v-t=\"'((?:[^\\\\]|\\\\.)*?)'\"/g;\n  return [ ...getMatches(file, directiveRegExp) ];\n}\n\nexport function extractI18NItemsFromVueFiles (sourceFiles: SimpleFile[]): I18NItemWithBounding[] {\n  return sourceFiles.reduce((accumulator, file) => {\n    const methodMatches = extractMethodMatches(file);\n    const componentMatches = extractComponentMatches(file);\n    const directiveMatches = extractDirectiveMatches(file);\n    return [\n      ...accumulator,\n      ...methodMatches,\n      ...componentMatches,\n      ...directiveMatches,\n    ];\n  }, [] as I18NItemWithBounding[]);\n}\n","import path from 'path';\nimport fs from 'fs';\nimport glob from 'glob';\nimport dot from 'dot-object';\nimport yaml from 'js-yaml';\nimport isValidGlob from 'is-valid-glob';\nimport { SimpleFile, I18NLanguage, I18NItem } from '../types';\n\nexport function readLanguageFiles (src: string): SimpleFile[] {\n  if (!isValidGlob(src)) {\n    throw new Error(`languageFiles isn't a valid glob pattern.`);\n  }\n\n  const targetFiles = glob.sync(src);\n\n  if (targetFiles.length === 0) {\n    throw new Error('languageFiles glob has no files.');\n  }\n\n  return targetFiles.map(f => {\n    const langPath = path.resolve(process.cwd(), f);\n\n    const extension = langPath.substring(langPath.lastIndexOf('.')).toLowerCase();\n    const isJSON = extension === '.json';\n    const isYAML = extension === '.yaml' || extension === '.yml';\n\n    let langObj;\n    if (isJSON) {\n      langObj = JSON.parse(fs.readFileSync(langPath, 'utf8'));\n    } else if (isYAML) {\n      langObj = yaml.load(fs.readFileSync(langPath, 'utf8'));\n    } else {\n      langObj = eval(fs.readFileSync(langPath, 'utf8'));\n    }\n\n    const fileName = f.replace(process.cwd(), '');\n\n    return { path: f, fileName, content: JSON.stringify(langObj) };\n  });\n}\n\nexport function extractI18NLanguageFromLanguageFiles (languageFiles: SimpleFile[]): I18NLanguage {\n  return languageFiles.reduce((accumulator, file) => {\n    const language = file.fileName.substring(file.fileName.lastIndexOf('/') + 1, file.fileName.lastIndexOf('.'));\n\n    if (!accumulator[language]) {\n      accumulator[language] = [];\n    }\n\n    const flattenedObject = dot.dot(JSON.parse(file.content));\n    Object.keys(flattenedObject).forEach((key, index) => {\n      accumulator[language].push({\n        path: key,\n        file: file.fileName,\n        line: index,\n      });\n    });\n\n    return accumulator;\n  }, {});\n}\n\nexport function writeMissingToLanguageFiles (parsedLanguageFiles: SimpleFile[], missingKeys: I18NItem[]): void {\n  parsedLanguageFiles.forEach(languageFile => {\n    const languageFileContent = JSON.parse(languageFile.content);\n\n    missingKeys.forEach(item => {\n      if (item.language && languageFile.fileName.includes(item.language) || !item.language) {\n        dot.str(item.path, '', languageFileContent);\n      }\n    });\n\n    writeLanguageFile(languageFile, languageFileContent);\n  });\n}\n\nexport function removeUnusedFromLanguageFiles (parsedLanguageFiles: SimpleFile[], unusedKeys: I18NItem[]): void {\n  parsedLanguageFiles.forEach(languageFile => {\n    const languageFileContent = JSON.parse(languageFile.content);\n\n    unusedKeys.forEach(item => {\n      if (item.language && languageFile.fileName.includes(item.language)) {\n        dot.delete(item.path, languageFileContent);\n      }\n    });\n\n    writeLanguageFile(languageFile, languageFileContent);\n  });\n}\n\nfunction writeLanguageFile (languageFile: SimpleFile, newLanguageFileContent: unknown) {\n  const fileExtension = languageFile.fileName.substring(languageFile.fileName.lastIndexOf('.') + 1);\n    const filePath = languageFile.path;\n    const stringifiedContent = JSON.stringify(newLanguageFileContent, null, 2);\n\n    if (fileExtension === 'json') {\n      fs.writeFileSync(filePath, stringifiedContent);\n    } else if (fileExtension === 'js') {\n      const jsFile = `export default ${stringifiedContent}; \\n`;\n      fs.writeFileSync(filePath, jsFile);\n    } else if (fileExtension === 'yaml' || fileExtension === 'yml') {\n      const yamlFile = yaml.dump(newLanguageFileContent);\n      fs.writeFileSync(filePath, yamlFile);\n    } else {\n      throw new Error(`Language filetype of ${fileExtension} not supported.`)\n    }\n}\n","import fs from 'fs';\nimport { I18NItem, I18NItemWithBounding, I18NLanguage, I18NReport } from '../types';\n\nfunction stripBounding (item: I18NItemWithBounding): I18NItem {\n  return {\n    path: item.path,\n    file: item.file,\n    line: item.line,\n  }\n}\n\nfunction mightBeDynamic (item: I18NItemWithBounding): boolean {\n  return item.path.includes('${') && !!item.previousCharacter.match(/`/g) && !!item.nextCharacter.match(/`/g);\n}\n\n// Looping through the arays multiple times might not be the most effecient, but it's the easiest to read and debug. Which at this scale is an accepted trade-off.\nexport function extractI18NReport (vueItems: I18NItemWithBounding[], languageFiles: I18NLanguage): I18NReport {\n  const missingKeys: I18NItem[] = [];\n  const unusedKeys: I18NItem[] = [];\n\n  const maybeDynamicKeys: I18NItem[] = vueItems\n    .filter(vueItem => mightBeDynamic(vueItem))\n    .map(vueItem => stripBounding(vueItem));\n\n  Object.keys(languageFiles).forEach(language => {\n    const languageItems = languageFiles[language];\n\n    const missingKeysInLanguage = vueItems\n      .filter(vueItem => !mightBeDynamic(vueItem))\n      .filter(vueItem => !languageItems.some(languageItem => vueItem.path === languageItem.path))\n      .map(vueItem => ({ ...stripBounding(vueItem), language }));\n\n    const unusedKeysInLanguage = languageItems\n      .filter(languageItem => !vueItems.some(vueItem => languageItem.path === vueItem.path || languageItem.path.startsWith(vueItem.path + '.')))\n      .map(languageItem => ({ ...languageItem, language }));\n\n    missingKeys.push(...missingKeysInLanguage);\n    unusedKeys.push(...unusedKeysInLanguage);\n  });\n\n  return {\n    missingKeys,\n    unusedKeys,\n    maybeDynamicKeys,\n  };\n}\n\nexport async function writeReportToFile (report: I18NReport, writePath: string): Promise<NodeJS.ErrnoException | void> {\n  const reportString = JSON.stringify(report);\n  return new Promise((resolve, reject) => {\n    fs.writeFile(\n      writePath,\n      reportString,\n      (err) => {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve();\n      },\n    );\n  });\n}\n\n","import path from 'path';\nimport { ReportOptions, I18NReport } from '../types';\nimport { readVueFiles, extractI18NItemsFromVueFiles } from './vue-files';\nimport { readLanguageFiles, extractI18NLanguageFromLanguageFiles, removeUnusedFromLanguageFiles, writeMissingToLanguageFiles } from './language-files';\nimport { extractI18NReport,  writeReportToFile } from './report';\n\nexport async function createI18NReport (options: ReportOptions): Promise<I18NReport> {\n  const {\n    vueFiles: vueFilesGlob,\n    languageFiles: languageFilesGlob,\n    output,\n    add,\n    remove,\n    ci\n  } = options;\n\n  if (!vueFilesGlob) throw new Error('Required configuration vueFiles is missing.');\n  if (!languageFilesGlob) throw new Error('Required configuration languageFiles is missing.');\n\n  const vueFiles = readVueFiles(path.resolve(process.cwd(), vueFilesGlob));\n  const languageFiles = readLanguageFiles(path.resolve(process.cwd(), languageFilesGlob));\n\n  const I18NItems = extractI18NItemsFromVueFiles(vueFiles);\n  const I18NLanguage = extractI18NLanguageFromLanguageFiles(languageFiles);\n\n  const report = extractI18NReport(I18NItems, I18NLanguage);\n\n  if (report.missingKeys.length) console.info('\\nMissing Keys'), console.table(report.missingKeys);\n  if (report.unusedKeys.length) console.info('\\nUnused Keys'), console.table(report.unusedKeys);\n  if (report.maybeDynamicKeys.length) console.warn('\\nSuspected Dynamic Keys Found\\nvue-i18n-extract does not compile Vue templates and therefore can not infer the correct key for the following keys.'), console.table(report.maybeDynamicKeys);\n\n  if (output) {\n    await writeReportToFile(report, path.resolve(process.cwd(), output));\n    console.info(`\\nThe report has been has been saved to ${output}`);\n  }\n\n  if (add && report.missingKeys.length) {\n    writeMissingToLanguageFiles(languageFiles, report.missingKeys);\n    console.info('\\nThe missing keys have been added to your language files.');\n  }\n  if (remove && report.unusedKeys.length) {\n    removeUnusedFromLanguageFiles(languageFiles, report.unusedKeys);\n    console.info('\\nThe unused keys have been removed from your language files.');\n  }\n\n  if (ci && report.missingKeys.length) {\n    throw new Error(`${report.missingKeys.length} missing keys found.`);\n  }\n\n  return report;\n}\n\nexport * from './vue-files';\nexport * from './language-files';\nexport * from './report';\n","export * from './config-file';\nexport * from './create-report';\nexport * from './types';\n\nprocess.on('uncaughtException', (err) => {\n  console.error('[vue-i18n-extract]', err);\n  process.exit(1);\n});\n\nprocess.on('unhandledRejection', (err) => {\n  console.error('[vue-i18n-extract]', err);\n  process.exit(1);\n});\n"],"names":["vueFiles","languageFiles","output","add","remove","ci","initCommand","fs","writeFileSync","path","resolve","process","cwd","JSON","stringify","defaultConfig","resolveConfig","argvOptions","cac","parse","argv","run","options","pathToConfigFile","configFile","require","console","info","readVueFiles","src","isValidGlob","Error","targetFiles","glob","sync","length","map","f","fileName","replace","content","readFileSync","getMatches","file","regExp","captureGroup","match","exec","pathAtIndex","indexOf","previousCharacter","charAt","nextCharacter","line","substring","index","extractMethodMatches","methodRegExp","extractComponentMatches","componentRegExp","extractDirectiveMatches","directiveRegExp","extractI18NItemsFromVueFiles","sourceFiles","reduce","accumulator","methodMatches","componentMatches","directiveMatches","readLanguageFiles","langPath","extension","lastIndexOf","toLowerCase","isJSON","isYAML","langObj","yaml","load","eval","extractI18NLanguageFromLanguageFiles","language","flattenedObject","dot","Object","keys","forEach","key","push","writeMissingToLanguageFiles","parsedLanguageFiles","missingKeys","languageFile","languageFileContent","item","includes","str","writeLanguageFile","removeUnusedFromLanguageFiles","unusedKeys","delete","newLanguageFileContent","fileExtension","filePath","stringifiedContent","jsFile","yamlFile","dump","stripBounding","mightBeDynamic","extractI18NReport","vueItems","maybeDynamicKeys","filter","vueItem","languageItems","missingKeysInLanguage","some","languageItem","unusedKeysInLanguage","startsWith","writeReportToFile","report","writePath","reportString","Promise","reject","writeFile","err","createI18NReport","vueFilesGlob","languageFilesGlob","I18NItems","I18NLanguage","table","warn","on","error","exit"],"mappings":"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"}