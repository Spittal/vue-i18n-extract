{"version":3,"file":"vue-i18n-extract.modern.js","sources":["../src/init-command/vue-i18n-extract.config.js","../src/init-command/index.ts","../src/report-command/vue-files.ts","../src/report-command/language-files.ts","../src/report-command/report.ts","../src/report-command/index.ts"],"sourcesContent":["\nexport default {\n  vueFilesPath: './', // The Vue.js file(s) you want to extract i18n strings from. It can be a path to a folder or to a file. It accepts glob patterns. (ex. *, ?, (pattern|pattern|pattern)\n  languageFilesPath: './', // The language file(s) you want to compare your Vue.js file(s) to. It can be a path to a folder or to a file. It accepts glob patterns (ex. *, ?, (pattern|pattern|pattern)\n  options: {\n    output: false, // false | string => Use if you want to create a json file out of your report. (ex. output.json)\n    add: false, // false | true => Use if you want to add missing keys into your json language files.\n    dynamic: false, // false | 'ignore' | 'report' => 'ignore' if you want to ignore dynamic keys false-positive. 'report' to get dynamic keys report.\n  }\n};\n","import fs from 'fs';\nimport path from 'path';\nimport defaultConfig from './vue-i18n-extract.config.js';\n\nexport function initCommand(): void {\n  fs.writeFileSync(\n    path.resolve(process.cwd(), './vue-i18n-extract.config.js'),\n    `module.exports = ${JSON.stringify(defaultConfig, null, 2)}`,\n  );\n}\n\n","import { SimpleFile, I18NItem } from '../types';\nimport isValidGlob from 'is-valid-glob';\nimport glob from 'glob';\nimport fs from 'fs';\n\nexport function readVueFiles (src: string): SimpleFile[] {\n  if (!isValidGlob(src)) {\n    throw new Error(`vueFiles isn't a valid glob pattern.`);\n  }\n\n  const targetFiles = glob.sync(src);\n\n  if (targetFiles.length === 0) {\n    throw new Error('vueFiles glob has no files.');\n  }\n\n  return targetFiles.map((f) => {\n    const fileName = f.replace(process.cwd(), '');\n    return { fileName, path: f, content: fs.readFileSync(f, 'utf8') };\n  });\n}\n\nfunction* getMatches (file: SimpleFile, regExp: RegExp, captureGroup = 1): IterableIterator<I18NItem> {\n  while (true) {\n    const match = regExp.exec(file.content);\n    if (match === null) {\n      break;\n    }\n    const line = (file.content.substring(0, match.index).match(/\\n/g) || []).length + 1;\n    yield {\n      path: match[captureGroup],\n      file: file.fileName,\n      line,\n    };\n  }\n}\n\n/**\n * Extracts translation keys from methods such as `$t` and `$tc`.\n *\n * - **regexp pattern**: (?:[$ .]tc?)\\(\n *\n *   **description**: Matches the sequence t( or tc(, optionally with either “$”, “.” or “ ” in front of it.\n *\n * - **regexp pattern**: ([\"'`])\n *\n *   **description**: 1. capturing group. Matches either “\"”, “'”, or “`”.\n *\n * - **regexp pattern**: ((?:[^\\\\]|\\\\.)*?)\n *\n *   **description**: 2. capturing group. Matches anything except a backslash\n *   *or* matches any backslash followed by any character (e.g. “\\\"”, “\\`”, “\\t”, etc.)\n *\n * - **regexp pattern**: \\1\n *\n *   **description**: matches whatever was matched by capturing group 1 (e.g. the starting string character)\n *\n * @param file a file object\n * @returns a list of translation keys found in `file`.\n */\n function extractMethodMatches (file: SimpleFile): I18NItem[] {\n  const methodRegExp = /(?:[$ .]tc?)\\(\\s*?([\"'`])((?:[^\\\\]|\\\\.)*?)\\1/g;\n  return [ ...getMatches(file, methodRegExp, 2) ];\n}\n\nfunction extractComponentMatches (file: SimpleFile): I18NItem[] {\n  const componentRegExp = /(?:<i18n)(?:.|\\n)*?(?:[^:]path=(\"|'))((?:[^\\\\]|\\\\.)*?)\\1/gi;\n  return [ ...getMatches(file, componentRegExp, 2) ];\n}\n\nfunction extractDirectiveMatches (file: SimpleFile): I18NItem[] {\n  const directiveRegExp = /v-t=\"'((?:[^\\\\]|\\\\.)*?)'\"/g;\n  return [ ...getMatches(file, directiveRegExp) ];\n}\n\nfunction extractI18nItemsFromVueFiles (sourceFiles: SimpleFile[]): I18NItem[] {\n  return sourceFiles.reduce((accumulator, file) => {\n    const methodMatches = extractMethodMatches(file);\n    const componentMatches = extractComponentMatches(file);\n    const directiveMatches = extractDirectiveMatches(file);\n    return [\n      ...accumulator,\n      ...methodMatches,\n      ...componentMatches,\n      ...directiveMatches,\n    ];\n  }, [] as I18NItem[]);\n}\n\nexport function parseVueFiles (vueFilesPath: string): I18NItem[] {\n  const filesList = readVueFiles(vueFilesPath);\n  return extractI18nItemsFromVueFiles(filesList);\n}\n","import path from 'path';\nimport fs from 'fs';\nimport glob from 'glob';\nimport dot from 'dot-object';\nimport yaml from 'js-yaml';\nimport isValidGlob from 'is-valid-glob';\nimport { SimpleFile, I18NLanguage, I18NItem } from '../types';\n\nfunction readLangFiles (src: string): SimpleFile[] {\n  if (!isValidGlob(src)) {\n    throw new Error(`languageFiles isn't a valid glob pattern.`);\n  }\n\n  const targetFiles = glob.sync(src);\n\n  if (targetFiles.length === 0) {\n    throw new Error('languageFiles glob has no files.');\n  }\n\n  return targetFiles.map(f => {\n    const langPath = path.resolve(process.cwd(), f);\n\n    const extension = langPath.substring(langPath.lastIndexOf('.')).toLowerCase();\n    const isJSON = extension === '.json';\n    const isYAML = extension === '.yaml' || extension === '.yml';\n\n    let langObj;\n    if (isJSON) {\n      langObj = JSON.parse(fs.readFileSync(langPath, 'utf8'));\n    } else if (isYAML) {\n      langObj = yaml.load(fs.readFileSync(langPath, 'utf8'));\n    } else {\n      langObj = eval(fs.readFileSync(langPath, 'utf8'));\n    }\n\n    const fileName = f.replace(process.cwd(), '');\n\n    return { path: f, fileName, content: JSON.stringify(langObj) };\n  });\n}\n\nfunction extractI18nItemsFromLanguageFiles (languageFiles: SimpleFile[]): I18NLanguage {\n  return languageFiles.reduce((accumulator, file) => {\n    const language = file.fileName.substring(file.fileName.lastIndexOf('/') + 1, file.fileName.lastIndexOf('.'));\n\n    if (!accumulator[language]) {\n      accumulator[language] = [];\n    }\n\n    const flattenedObject = dot.dot(JSON.parse(file.content));\n    Object.keys(flattenedObject).forEach((key, index) => {\n      accumulator[language].push({\n        path: key,\n        file: file.fileName,\n        line: index,\n      });\n    });\n\n    return accumulator;\n  }, {});\n}\n\nexport function writeMissingToLanguage (resolvedLanguageFiles: string, missingKeys: I18NItem[]): void {\n  const languageFiles = readLangFiles(resolvedLanguageFiles);\n  languageFiles.forEach(languageFile => {\n    const languageFileContent = JSON.parse(languageFile.content);\n\n    missingKeys.forEach(item => {\n      if (item.language && languageFile.fileName.includes(item.language) || !item.language) {\n        dot.str(item.path, '', languageFileContent);\n      }\n    });\n\n    const fileExtension = languageFile.fileName.substring(languageFile.fileName.lastIndexOf('.') + 1);\n    const filePath = languageFile.path;\n    const stringifiedContent = JSON.stringify(languageFileContent, null, 2);\n\n    if (fileExtension === 'json') {\n      fs.writeFileSync(filePath, stringifiedContent);\n    } else if (fileExtension === 'js') {\n      const jsFile = `export default ${stringifiedContent}; \\n`;\n      fs.writeFileSync(filePath, jsFile);\n    } else if (fileExtension === 'yaml' || fileExtension === 'yml') {\n      const yamlFile = yaml.dump(languageFileContent);\n      fs.writeFileSync(filePath, yamlFile);\n    }\n  });\n}\n\nexport function parseLanguageFiles (languageFilesPath: string): I18NLanguage {\n  const filesList = readLangFiles(languageFilesPath);\n  return extractI18nItemsFromLanguageFiles(filesList);\n}\n","import fs from 'fs';\nimport { I18NItem, I18NLanguage, I18NReport } from '../types';\n\nexport enum VueI18NExtractReportTypes {\n  None = 0,\n  Missing = 1 << 0,\n  Unused = 1 << 1,\n  Dynamic = 1 << 2,\n  All = ~(~0 << 3)\n};\n\nconst mightBeUsedDynamically = function (languageItem: I18NItem, dynamicKeys: I18NItem[]): boolean {\n  return dynamicKeys.some(dynamicKey => languageItem.path.includes(dynamicKey.path));\n}\n\nexport function extractI18NReport (parsedVueFiles: I18NItem[], parsedLanguageFiles: I18NLanguage, reportType: VueI18NExtractReportTypes = VueI18NExtractReportTypes.Missing + VueI18NExtractReportTypes.Unused): I18NReport {\n  const missingKeys: I18NItem[] = [];\n  const unusedKeys: I18NItem[] = [];\n  const dynamicKeys: I18NItem[] = [];\n  const dynamicReportEnabled = reportType & VueI18NExtractReportTypes.Dynamic;\n\n  Object.keys(parsedLanguageFiles).forEach(language => {\n    let languageItems = parsedLanguageFiles[language];\n\n    parsedVueFiles.forEach(vueItem => {\n      const usedByVueItem = function (languageItem: I18NItem): boolean {\n        return languageItem.path === vueItem.path || languageItem.path.startsWith(vueItem.path + '.');\n      }\n\n      if (dynamicReportEnabled && (vueItem.path.includes('${') || vueItem.path.endsWith('.'))) {\n        dynamicKeys.push(({ ...vueItem, language }))\n        return\n      }\n\n      if (!parsedLanguageFiles[language].some(usedByVueItem)) {\n        missingKeys.push(({ ...vueItem, language }));\n      }\n\n      languageItems = languageItems.filter(languageItem => dynamicReportEnabled ?\n        !mightBeUsedDynamically(languageItem, dynamicKeys) && !usedByVueItem(languageItem) :\n        !usedByVueItem(languageItem));\n    });\n\n    unusedKeys.push(...languageItems.map((item) => ({ ...item, language })));\n  });\n\n  let extracts = {};\n  if (reportType & VueI18NExtractReportTypes.Missing) {\n    extracts = Object.assign(extracts, { missingKeys });\n  }\n  if (reportType & VueI18NExtractReportTypes.Unused) {\n    extracts = Object.assign(extracts, { unusedKeys });\n  }\n  if (dynamicReportEnabled) {\n    extracts = Object.assign(extracts, { dynamicKeys });\n  }\n\n  return extracts;\n}\n\nexport async function writeReportToFile (report: I18NReport, writePath: string): Promise<NodeJS.ErrnoException | void> {\n  const reportString = JSON.stringify(report);\n  return new Promise((resolve, reject) => {\n    fs.writeFile(\n      writePath,\n      reportString,\n      (err) => {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve();\n      },\n    );\n  });\n}\n\n","import path from 'path';\nimport fs from 'fs';\n\nimport { ReportOptions, I18NReport } from '../types';\nimport { parseVueFiles } from './vue-files';\nimport { parseLanguageFiles, writeMissingToLanguage } from './language-files';\nimport { extractI18NReport, VueI18NExtractReportTypes, writeReportToFile } from './report';\n\nexport function createI18NReport (vueFiles: string, languageFiles: string, command: ReportOptions): I18NReport {\n  const resolvedVueFiles = path.resolve(process.cwd(), vueFiles);\n  const resolvedLanguageFiles = path.resolve(process.cwd(), languageFiles);\n\n  const parsedVueFiles = parseVueFiles(resolvedVueFiles);\n  const parsedLanguageFiles = parseLanguageFiles(resolvedLanguageFiles);\n\n  const reportType = command.dynamic ? VueI18NExtractReportTypes.All : (VueI18NExtractReportTypes.Missing + VueI18NExtractReportTypes.Unused);\n\n  return extractI18NReport(parsedVueFiles, parsedLanguageFiles, reportType);\n}\n\nexport function reportFromConfigCommand(): Promise<void> | void {\n  try {\n    const configFile = eval(fs.readFileSync(path.resolve(process.cwd(), './vue-i18n-extract.config.js'), 'utf8'));\n    console.log(configFile);\n\n    return reportCommand({\n      vueFiles: configFile.vueFilesPath,\n      languageFiles: configFile.languageFilesPath,\n      ...(configFile.options.output && {output: configFile.options.output }),\n      ...(configFile.options.add && { add: Boolean(configFile.options.add) }),\n      ...(configFile.options.dynamic && {dynamic: [false, 'ignore', 'report'].findIndex(e => e === configFile.options.dynamic) }),\n    });\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nexport async function reportCommand (command: ReportOptions): Promise<void> {\n  const { vueFiles, languageFiles, output, add, dynamic, ci } = command;\n  const report = createI18NReport(vueFiles, languageFiles, command);\n\n  if (report.missingKeys) console.info('missing keys: '), console.table(report.missingKeys);\n  if (report.unusedKeys) console.info('unused keys: '), console.table(report.unusedKeys);\n  if (report.dynamicKeys && dynamic && dynamic > 1) console.info('dynamic detected keys: '), console.table(report.dynamicKeys);\n\n  if (output) {\n    await writeReportToFile(report, path.resolve(process.cwd(), output));\n    console.log(`The report has been has been saved to ${output}`);\n  }\n\n  if (add && report.missingKeys && report.missingKeys.length > 0) {\n    const resolvedLanguageFiles = path.resolve(process.cwd(), languageFiles);\n    writeMissingToLanguage(resolvedLanguageFiles, report.missingKeys);\n    console.log('The missing keys have been added to your languages files');\n  }\n\n  if (ci && Object.prototype.hasOwnProperty.call(report, 'missingKeys') && report.missingKeys !== undefined) {\n    const exitCode = report.missingKeys.length > 0 ? 1 : 0;\n    console.log(`[vue-i18n-extract] ${report.missingKeys.length} missing keys found.`);\n    process.exit(exitCode);\n  }\n}\n\nexport * from './vue-files';\nexport * from './language-files';\nexport * from './report';\n"],"names":["vueFilesPath","languageFilesPath","options","output","add","dynamic","initCommand","fs","writeFileSync","path","resolve","process","cwd","JSON","stringify","defaultConfig","readVueFiles","src","isValidGlob","Error","targetFiles","glob","sync","length","map","f","fileName","replace","content","readFileSync","getMatches","file","regExp","captureGroup","match","exec","line","substring","index","extractMethodMatches","methodRegExp","extractComponentMatches","componentRegExp","extractDirectiveMatches","directiveRegExp","extractI18nItemsFromVueFiles","sourceFiles","reduce","accumulator","methodMatches","componentMatches","directiveMatches","parseVueFiles","filesList","readLangFiles","langPath","extension","lastIndexOf","toLowerCase","isJSON","isYAML","langObj","parse","yaml","load","eval","extractI18nItemsFromLanguageFiles","languageFiles","language","flattenedObject","dot","Object","keys","forEach","key","push","writeMissingToLanguage","resolvedLanguageFiles","missingKeys","languageFile","languageFileContent","item","includes","str","fileExtension","filePath","stringifiedContent","jsFile","yamlFile","dump","parseLanguageFiles","VueI18NExtractReportTypes","mightBeUsedDynamically","languageItem","dynamicKeys","some","dynamicKey","extractI18NReport","parsedVueFiles","parsedLanguageFiles","reportType","Missing","Unused","unusedKeys","dynamicReportEnabled","Dynamic","languageItems","vueItem","usedByVueItem","startsWith","endsWith","filter","extracts","assign","writeReportToFile","report","writePath","reportString","Promise","reject","writeFile","err","createI18NReport","vueFiles","command","resolvedVueFiles","All","reportFromConfigCommand","configFile","console","log","reportCommand","Boolean","findIndex","e","error","ci","info","table","prototype","hasOwnProperty","call","undefined","exitCode","exit"],"mappings":"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"},CAAaD,QAAb;AACD;AACF;;;;"}